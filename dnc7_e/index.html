<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dungeon & Copilot 7</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            body {
                background-color: #1a1a1a;
                color: #e0e0e0;
            }

            .container {
                background-color: #2d2d2d;
                box-shadow: 0 2px 10px rgba(0,0,0,0.5);
            }

            .tabs {
                background-color: #1f1f1f;
                border-bottom: 2px solid #404040;
            }

            .tab {
                background-color: #333333;
                border-right: 1px solid #404040;
                color: #b0b0b0;
            }

            .tab:hover {
                background-color: #404040;
            }

            .tab.active {
                background-color: #667eea;
                color: white;
            }

            .tab.locked {
                background-color: #252525;
                color: #666666;
            }

            .tab.locked:hover {
                background-color: #252525;
            }

            .message {
                color: #e0e0e0;
                background-color: #333333;
            }
            
            .container {
                background-color: #000000; /* pure black */
                /* or a slightly softer tone: #121212, #1a1a1a */
                box-shadow: 0 2px 10px rgba(0,0,0,0.5);
             }

          
        }

      

        .logo {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .logo img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 0 auto;
        }

        .tabs {
            display: flex;
            background-color: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
            overflow-x: auto;
        }

        .tab {
            flex: 1;
            padding: 15px 20px;
            text-align: center;
            cursor: pointer;
            background-color: #e9ecef;
            border: none;
            border-right: 1px solid #dee2e6;
            transition: all 0.3s ease;
            font-size: 16px;
            font-weight: bold;
            color: #495057;
            min-width: 120px;
        }

        .tab:last-child {
            border-right: none;
        }

        .tab:hover {
            background-color: #dee2e6;
        }

        .tab.active {
            background-color: #667eea;
            color: white;
        }

        .tab.locked {
            background-color: #f1f3f5;
            color: #adb5bd;
            cursor: not-allowed;
        }

        .tab.locked:hover {
            background-color: #f1f3f5;
        }

        .content {
            padding: 20px;
            min-height: 500px;
        }

        .message {
            padding: 40px;
            text-align: center;
            font-size: 18px;
            color: #495057;
            background-color: #f8f9fa;
            border-radius: 8px;
            margin: 20px;
        }

        #stageContent {
            width: 100%;
            border: none;
            overflow: hidden;
        }
        .nav-btn {
            background-color: #8b9cff;   /* ë²„íŠ¼ ì»¬ëŸ¬ */
            color: #fff;                /* í…ìŠ¤íŠ¸ ìƒ‰ìƒ */
            font-size: 16px;
            font-weight: bold;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            transition: background-color 0.3s ease;
            
        }

        /* hover íš¨ê³¼ */
        .nav-btn:hover {
            background-color: #6f82e6;  /* ì¡°ê¸ˆ ë” ì§„í•œ íŒŒë€ìƒ‰ */
        }

        /* ì´ì „ ë²„íŠ¼ê³¼ ë‹¤ìŒ ë²„íŠ¼ ê°œë³„ ìŠ¤íƒ€ì¼ (í•„ìš” ì‹œ) */
        .prev-btn {
            float: left;
            margin-left: 40px;  /* ì™¼ìª½ ì—¬ë°± */
        }

        .next-btn {
            float: right;
            margin-right: 40px;  /* ì™¼ìª½ ì—¬ë°± */
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">
            <img src="img/titlelogo.png" alt="Dungeon & Copilot 7">
        </div>
        
        <div class="tabs">
            <button class="tab" data-stage="0">Stage 0</button>
            <button class="tab locked" data-stage="1">Stage 1 ğŸ”’</button>
            <button class="tab locked" data-stage="2">Stage 2 ğŸ”’</button>
            <button class="tab locked" data-stage="3">Stage 3 ğŸ”’</button>
            <button class="tab locked" data-stage="4">Stage 4 ğŸ”’</button>
            <button class="tab locked" data-stage="5">Stage 5 ğŸ”’</button>
            <button class="tab locked" data-stage="6">Stage 6 ğŸ”’</button>
            <button class="tab locked" data-stage="7">Stage 7 ğŸ”’</button>
        </div>
        
        <div class="content">
            <div id="messageArea"></div>
            <iframe id="stageContent" src="" onload="resizeIframe(this)"></iframe>
        </div>
        

        <div class="controls" style="margin-top:0px; margin-bottom:70px;" >
            <button id="prevStageBtn" class="nav-btn prev-btn">&lt; Previous</button>
            <button id="nextStageBtn" class="nav-btn next-btn">Next &gt;</button>
        </div>



    <script>
/* DailyMissonìœ¼ë¡œ ì§„í–‰í•  ë•Œ */
        // // ì „ì—­ ë³€ìˆ˜ startDate ì„ ì–¸
        // var startDate = '20251017';

        // // iframe ë†’ì´ ìë™ ì¡°ì • í•¨ìˆ˜ (ì „ì—­ í•¨ìˆ˜ë¡œ ì„ ì–¸)
        // function resizeIframe(iframe) {
        //     try {
        //         const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
        //         if (iframeDoc && iframeDoc.body) {
        //             const height = iframeDoc.body.scrollHeight;
        //             iframe.style.height = (height + 30) + 'px';
        //         }
        //     } catch(e) {
        //         // ë¡œì»¬ íŒŒì¼ì€ ë¬¸ì œì—†ì§€ë§Œ í˜¹ì‹œ ëª¨ë¥¼ ì—ëŸ¬ ì²˜ë¦¬
        //         iframe.style.height = '500px';
        //     }
        // }

        // // postMessageë¥¼ í†µí•œ iframe ë†’ì´ ì¡°ì •
        // window.addEventListener('message', function(e) {
        //     if (e.data.type === 'resize') {
        //         const iframe = document.getElementById('stageContent');
        //         iframe.style.height = (e.data.height + 40) + 'px';
        //     }
        // });

        // $(document).ready(function() {
        //     // URL ë§¤ê°œë³€ìˆ˜ì—ì„œ startDate ê°€ì ¸ì˜¤ê¸°
        //     const urlParams = new URLSearchParams(window.location.search);
        //     const urlStartDate = urlParams.get('startDate');
            
        //     if (urlStartDate) {
        //         startDate = urlStartDate;
        //     }

        //     // ë‚ ì§œ ì°¨ì´ ê³„ì‚° í•¨ìˆ˜
        //     function getDaysDifference(startDateStr) {
        //         const year = parseInt(startDateStr.substring(0, 4));
        //         const month = parseInt(startDateStr.substring(4, 6)) - 1;
        //         const day = parseInt(startDateStr.substring(6, 8));
                
        //         const start = new Date(year, month, day);
        //         const today = new Date();
        //         today.setHours(0, 0, 0, 0);
                
        //         const diffTime = today - start;
        //         const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
                
        //         return diffDays;
        //     }

        //     // ë‚ ì§œ í¬ë§· í•¨ìˆ˜ (YYYYmmDD -> YYYYë…„ Mì›” Dì¼)
        //     function formatDate(dateStr) {
        //         const year = parseInt(dateStr.substring(0, 4));
        //         const month = parseInt(dateStr.substring(4, 6));
        //         const day = parseInt(dateStr.substring(6, 8));
        //         return year + 'ë…„ ' + month + 'ì›” ' + day + 'ì¼';
        //     }

        //     // ë‚ ì§œ ê³„ì‚° í•¨ìˆ˜ (startDate + days)
        //     function addDays(startDateStr, days) {
        //         const year = parseInt(startDateStr.substring(0, 4));
        //         const month = parseInt(startDateStr.substring(4, 6)) - 1;
        //         const day = parseInt(startDateStr.substring(6, 8));
                
        //         const date = new Date(year, month, day);
        //         date.setDate(date.getDate() + days);
                
        //         const resultYear = date.getFullYear();
        //         const resultMonth = String(date.getMonth() + 1).padStart(2, '0');
        //         const resultDay = String(date.getDate()).padStart(2, '0');
                
        //         return resultYear + resultMonth + resultDay;
        //     }

        //     // í´ë¦­ ê°€ëŠ¥í•œ íƒ­ ìˆ˜ ê³„ì‚°
        //     const daysPassed = getDaysDifference(startDate);
        //     const unlockableTabs = Math.min(Math.max(1, daysPassed + 1), 8); // ìµœì†Œ 1ê°œ(Stage 0), ìµœëŒ€ 8ê°œ

        //     // íƒ­ ìƒíƒœ ì—…ë°ì´íŠ¸
        //     $('.tab').each(function(index) {
        //         const stage = $(this).data('stage');
        //         if (stage < unlockableTabs) {
        //             $(this).removeClass('locked');
        //             $(this).text('Stage ' + stage);
        //         }
        //     });

        //     // íƒ­ í´ë¦­ ì´ë²¤íŠ¸
        //     $('.tab').on('click', function() {
        //         const stage = $(this).data('stage');
                
        //         if ($(this).hasClass('locked')) {
        //             // ì ê¸´ íƒ­ í´ë¦­ ì‹œ
        //             const unlockDate = addDays(startDate, stage);
        //             const unlockDateFormatted = formatDate(unlockDate);
        //             showMessage('ğŸ”’ Stage ' + stage + 'ì€(ëŠ”) ' + unlockDateFormatted + 'ì— ê°œë°©ë©ë‹ˆë‹¤.');
        //             return;
        //         }
                
        //         $('.tab').removeClass('active');
        //         $(this).addClass('active');
                
        //         loadStageContent(stage);
        //     });

        //     // ìŠ¤í…Œì´ì§€ ì»¨í…ì¸  ë¡œë“œ í•¨ìˆ˜
        //     function loadStageContent(stage) {
        //         $('#messageArea').hide();
        //         $('#stageContent').show();
        //         const stageFile = 'stage' + stage + '.html';
        //         $('#stageContent').attr('src', stageFile);
        //     }

        //     // ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜
        //     function showMessage(message) {
        //         $('#stageContent').hide();
        //         $('#messageArea').html('<div class="message">' + message + '</div>');
        //         $('#messageArea').show();
        //     }

        //     // ì´ˆê¸° Stage 0 ë¡œë“œ
        //     $('.tab[data-stage="0"]').addClass('active');
        //     loadStageContent(0);
        // });

        
/* Hands-on ì„¸ì…˜ìœ¼ë¡œ ì§„í–‰í•  ë•Œ  */
        // iframe ë†’ì´ ì¡°ì •: ê¸°ì¡´ ìœ ì§€
            function resizeIframe(iframe) {
                try {
                    const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                    if (iframeDoc && iframeDoc.body) {
                        const height = iframeDoc.body.scrollHeight;
                        iframe.style.height = (height + 30) + 'px';
                    }
                } catch(e) {
                    // ë¡œì»¬ íŒŒì¼ì€ ë¬¸ì œì—†ì§€ë§Œ í˜¹ì‹œ ëª¨ë¥¼ ì—ëŸ¬ ì²˜ë¦¬
                    iframe.style.height = '500px';
                }
            }

            // postMessageë¥¼ í†µí•œ iframe ë†’ì´ ì¡°ì •: ê¸°ì¡´ ìœ ì§€
            window.addEventListener('message', function(e) {
                if (e.data.type === 'resize') {
                    const iframe = document.getElementById('stageContent');
                    iframe.style.height = (e.data.height + 40) + 'px';
                }
            });

            $(document).ready(function() {
                // ----[ ìƒˆ ìƒíƒœ ê´€ë¦¬: ë‚ ì§œ ì œê±°, ë²„íŠ¼ ê¸°ë°˜ ]----
                const STORAGE_KEY = 'dungeonStageProgress'; // ì§„í–‰ìƒíƒœ ì €ì¥ìš© key
                const MAX_STAGE_KEY = 'dungeonMaxStage';    // ìµœëŒ€ ë„ë‹¬ ìŠ¤í…Œì´ì§€ ì €ì¥ìš©
                const totalStages = $('.tab').length;        // .tab ê°œìˆ˜(ì˜ˆ: 8ê°œë©´ 0~7)
                
                // URLë¡œ ì´ˆê¸°í™” ì œì–´ (?reset=true)
                const urlParams = new URLSearchParams(window.location.search);
                const shouldReset = urlParams.get('reset') === 'true';

                let currentStage = 0; // í˜„ì¬ ì„ íƒëœ ìŠ¤í…Œì´ì§€ ë²ˆí˜¸
                let maxStage = 0; // í™œì„±í™” ê°€ëŠ¥í•œ ìµœì¢… ìŠ¤í…Œì´ì§€ ë²ˆí˜¸

                if (!shouldReset) {
                    // localStorageì—ì„œ ì§„í–‰ ìƒíƒœ ë³µêµ¬
                    const saved = localStorage.getItem(STORAGE_KEY);
                    const openStage = localStorage.getItem(MAX_STAGE_KEY);
                    if (saved !== null) {
                        const n = parseInt(saved, 10);
                        if (!isNaN(n) && n >= 0 && n < totalStages) {
                            currentStage = n;
                        }
                    }
                    if (openStage !== null) {
                        const m = parseInt(openStage, 10);
                        if (!isNaN(m) && m >= 0 && m < totalStages) {
                            maxStage = m;
                        }
                    }
                } else {
                    // ì´ˆê¸°í™” ìš”ì²­ ì‹œ 0ìœ¼ë¡œ ë¦¬ì…‹
                    localStorage.removeItem(STORAGE_KEY);
                    localStorage.removeItem(MAX_STAGE_KEY);
                }

                // ì´ˆê¸° ì ê¸ˆ/í•´ì œ ì ìš©
                function applyLocks() {
                    $('.tab').each(function() {
                        const stage = parseInt($(this).data('stage'), 10);
                        if (stage <= currentStage || stage <= maxStage ) {
                            $(this).removeClass('locked').text('Stage ' + stage);
                        } else {
                            $(this).addClass('locked').text('ğŸ”’ Stage ' + stage);
                        }
                    });
                }

                // ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜: ê¸°ì¡´ ìœ ì§€
                function showMessage(message) {
                    $('#stageContent').hide();
                    $('#messageArea').html('<div class="message">' + message + '</div>');
                    $('#messageArea').show();
                }

                // ìŠ¤í…Œì´ì§€ ì»¨í…ì¸  ë¡œë“œ í•¨ìˆ˜: ê¸°ì¡´ ìœ ì§€
                function loadStageContent(stage) {
                    $('#messageArea').hide();
                    $('#stageContent').show();
                    const stageFile = 'stage' + stage + '.html';
                    $('#stageContent').attr('src', stageFile);
                }

                // íƒ­ í´ë¦­ ì´ë²¤íŠ¸: ì ê¸ˆ/í•´ì œ ê¸°ì¤€ ë³€ê²½
                $('.tab').on('click', function() {
                    const stage = parseInt($(this).data('stage'), 10);

                    if ($(this).hasClass('locked')) {
                        // ì ê¸´ íƒ­ í´ë¦­ ì‹œ: ë‚ ì§œ ì•ˆë‚´ ëŒ€ì‹  ë²„íŠ¼ ì•ˆë‚´ë¡œ ë³€ê²½
                        showMessage('ğŸ”’ ì•„ì§ ì ê¸´ ìŠ¤í…Œì´ì§€ì…ë‹ˆë‹¤. ì•„ë˜ "ë‹¤ìŒ ìŠ¤í…Œì´ì§€" ë²„íŠ¼ì„ ëˆŒëŸ¬ ì§„í–‰í•´ ì£¼ì„¸ìš”.');
                        return;
                    }

                    $('.tab').removeClass('active');
                    $(this).addClass('active');
                    currentStage = stage;
                    loadStageContent(stage);
                });

                // ë‹¤ìŒ ìŠ¤í…Œì´ì§€ ë²„íŠ¼ í•¸ë“¤ëŸ¬
                // HTMLì— ì•„ë˜ ë²„íŠ¼ì´ ìˆë‹¤ê³  ê°€ì •: <button id="nextStageBtn">ë‹¤ìŒ ìŠ¤í…Œì´ì§€</button>
                $('#nextStageBtn').on('click', function() {
                    if (currentStage >= totalStages - 1) {
                        // ë§ˆì§€ë§‰ ìŠ¤í…Œì´ì§€ì¸ ê²½ìš°
                        showMessage('ğŸ‰ ëª¨ë“  ìŠ¤í…Œì´ì§€ë¥¼ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤!');
                        return;
                    }
                    currentStage += 1;           // ë‹¤ìŒ ë‹¨ê³„ë¡œ ì§„í–‰
                    localStorage.setItem(STORAGE_KEY, String(currentStage));
                    if(currentStage > maxStage){
                        maxStage += 1;
                        localStorage.setItem(MAX_STAGE_KEY, String(maxStage));
                    }
                    applyLocks();                // ì ê¸ˆ/í•´ì œ ìƒíƒœ ê°±ì‹ 

                    // ìƒˆë¡œ ì—´ë¦° íƒ­ì„ í™œì„±í™”í•˜ê³  ì»¨í…ì¸  ë¡œë“œ
                    const $nextTab = $('.tab[data-stage="' + currentStage + '"]');
                    $('.tab').removeClass('active');
                    $nextTab.removeClass('locked').addClass('active').text('Stage ' + currentStage);
                    loadStageContent(currentStage);
                });

                // (ì„ íƒ) ì´ì „ ìŠ¤í…Œì´ì§€ ë²„íŠ¼ë„ ì œê³µ ê°€ëŠ¥
                // HTML ì˜ˆ: <button id="prevStageBtn">ì´ì „ ìŠ¤í…Œì´ì§€</button>
                $('#prevStageBtn').on('click', function() {
                    if (currentStage <= 0) {
                        showMessage('í˜„ì¬ ìŠ¤í…Œì´ì§€ê°€ ì‹œì‘ ë‹¨ê³„ì…ë‹ˆë‹¤.');
                        return;
                    }
                    currentStage -= 1;
                    localStorage.setItem(STORAGE_KEY, String(currentStage));
                    applyLocks();

                    const $prevTab = $('.tab[data-stage="' + currentStage + '"]');
                    $('.tab').removeClass('active');
                    $prevTab.addClass('active');
                    loadStageContent(currentStage);
                });

                // ì´ˆê¸° ì ìš©: Stage 0 í™œì„±í™” ë° ì ê¸ˆ ìƒíƒœ ë°˜ì˜
                applyLocks();
                const $initialTab = $('.tab[data-stage="' + currentStage + '"]');
                $initialTab.removeClass('locked').addClass('active').text('Stage ' + currentStage);
                loadStageContent(currentStage);
            });

    </script>
</body>
</html>

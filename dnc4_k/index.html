<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ë˜ì „ì•¤ì½”íŒŒì¼ëŸ¿4</title>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <style>
    :root { color-scheme: light dark; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 0; padding: 2rem; }
  .container { max-width: 960px; margin: 0 auto; }
    h1 { margin: 0 0 1rem; font-size: 1.6rem; }
    .panel { border: 1px solid #9993; border-radius: 12px; padding: 1.25rem; margin-top: 1rem; }
    label { display: block; margin: .5rem 0 .25rem; font-weight: 600; }
    input[type="text"], input[type="password"] {
      width: 100%; padding: .75rem .9rem; border: 1px solid #9996; border-radius: 10px; font-size: 1rem;
    }
  /* callsign & keycode fields width override */
  #callsign, #keycode { width: 400px; max-width: 100%; }
    button {
      margin-top: .75rem; padding: .3rem .7rem; font-size: 1rem; border-radius: 10px; border: 1px solid #0000;
      background: #2563eb; color: white; cursor: pointer;
    }
    button.secondary { background: #e5e7eb; color: #111827; }
    .row { display: flex; gap: .5rem; align-items: center; flex-wrap: wrap; }
    .hint { color: #6b7280; font-size: .95rem; margin-top: .25rem; }
    .status { font-weight: 600; margin: .25rem 0 .75rem; }
    .error { color: #dc2626; margin-top: .5rem; }
    .success { color: #16a34a; margin-top: .5rem; }
    .badge { display: inline-block; padding: .2rem .55rem; border-radius: 999px; font-size: .85rem; background: #e5e7eb; color: #111827; }
    .spacer { height: .5rem; }

    /* Stage image header */
  .stage-hero { background: #fff; padding: 12px 16px; }
    @media (prefers-color-scheme: dark) { .stage-hero { background: #111827; } }
  .stage-hero img { display: block; width: 100%; max-width: 960px; height: auto; margin: 0 auto; }
  /* Stage iframe (local file fallback) */
  .stage-iframe { width: 100%; border: 0; min-height: 320px; background: transparent; }
  /* Center the "vibe" message */
  .vibe { text-align: center; margin-top: 30px; }
  details.fold summary { cursor: pointer; }
	details.fold .fold-body { margin-top: .5rem; }
  </style>
</head>
<body>
  <header class="stage-hero" role="banner">
    <img id="stageImg" src="img/ê·¸ë¦¼0.png" alt="ìŠ¤í…Œì´ì§€ ì´ë¯¸ì§€" />
  </header>
  <div class="container">
    <div id="app" class="panel"></div>
  </div>

  <script>
    // jQuery fallback loader for file:// or blocked CDN
    function ensureJQuery(then, fail) {
      if (window.jQuery) { then(); return; }
      var alt = document.createElement('script');
      alt.src = 'https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js';
      alt.onload = function(){ then(); };
      alt.onerror = function(){ if (fail) fail(); };
      document.head.appendChild(alt);
    }

    // --- Cookie helpers ---
    function setCookie(name, value, days) {
      var expires = "";
      if (days) {
        var date = new Date();
        date.setTime(date.getTime() + (days*24*60*60*1000));
        expires = "; expires=" + date.toUTCString();
      }
      document.cookie = name + "=" + encodeURIComponent(value) + expires + "; path=/";
    }
    function getCookie(name) {
      var nameEQ = name + "=";
      var ca = document.cookie.split(';');
      for (var i = 0; i < ca.length; i++) {
        var c = ca[i].trim();
        if (c.indexOf(nameEQ) === 0) return decodeURIComponent(c.substring(nameEQ.length, c.length));
      }
      return null;
    }
    function eraseCookie(name) {
      document.cookie = name + "=; Max-Age=-1; path=/";
    }

    // --- App state ---
    // KEYCODESëŠ” key.jsì—ì„œ ì‹¤ì‹œê°„ìœ¼ë¡œ ê°€ì ¸ì˜µë‹ˆë‹¤

    // --- Key code loader for both file:// and server environments ---
    function loadKeyCodes(callback) {
      // ì´ë¯¸ ë¡œë“œëœ KEYCODESê°€ ìˆìœ¼ë©´ ì‚­ì œ
      if (window.KEYCODES) {
        delete window.KEYCODES;
      }
      
      // ê¸°ì¡´ ìŠ¤í¬ë¦½íŠ¸ íƒœê·¸ê°€ ìˆìœ¼ë©´ ì œê±°
      var oldScript = document.getElementById('keycode-script');
      if (oldScript && oldScript.parentNode) {
        oldScript.parentNode.removeChild(oldScript);
      }
      
      // ìƒˆë¡œìš´ ìŠ¤í¬ë¦½íŠ¸ íƒœê·¸ë¥¼ ë™ì ìœ¼ë¡œ ìƒì„±í•˜ì—¬ key.js ë¡œë“œ
      var script = document.createElement('script');
      script.id = 'keycode-script';
      script.src = './key.js?_t=' + Date.now(); // ìºì‹œ ë°©ì§€
      
      script.onload = function() {
        if (window.KEYCODES) {
          callback(null, window.KEYCODES);
        } else {
          callback('key.js íŒŒì¼ì— KEYCODES ë³€ìˆ˜ê°€ ì •ì˜ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.');
        }
      };
      
      script.onerror = function() {
        callback('key.js íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. íŒŒì¼ì´ ê°™ì€ í´ë”ì— ìˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.');
      };
      
      document.head.appendChild(script);
    }

    // --- Stage image header helpers ---
    // NOTE: ì´ë¯¸ì§€ íŒŒì¼ì€ ëª¨ë‘ `img/` í´ë”ì— ìˆìœ¼ë¯€ë¡œ ë¦¬ìŠ¤íŠ¸ì™€ ë°˜í™˜ê°’ì— `img/` ì ‘ë‘ì‚¬ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
    var STAGE_IMG_LIST = [
      "img/ê·¸ë¦¼0.png",
      "img/ê·¸ë¦¼1.png",
      "img/ê·¸ë¦¼2.png",
      "img/ê·¸ë¦¼3.png",
      "img/ê·¸ë¦¼4.png",
      "img/ê·¸ë¦¼5.png",
      "img/ê·¸ë¦¼6.png",
      "img/ê·¸ë¦¼7.png"
    ];
    // Preload images to minimize flicker
    (function preloadStageImages(){
      for (var i = 0; i < STAGE_IMG_LIST.length; i++) {
        var im = new Image(); im.src = STAGE_IMG_LIST[i];
      }
    })();
    function getStageImage(stage) {
      if (stage === "complete") return "img/ê·¸ë¦¼7.png";
      var n = parseInt(stage, 10);
      if (isNaN(n) || n <= 0) return "img/ê·¸ë¦¼0.png"; // Stage0 default
      if (n >= 1 && n <= 7) return "img/ê·¸ë¦¼" + n + ".png";
      return "img/ê·¸ë¦¼0.png";
    }
    function updateStageHero(stage) {
      var imgEl = document.getElementById('stageImg');
      if (!imgEl) return;
      var src = getStageImage(stage);
      if (imgEl.getAttribute('src') !== src) {
        imgEl.src = src;
      }
      // Optional: alt text for accessibility
      if (stage === 'complete') {
        imgEl.alt = 'ì™„ë£Œ ìŠ¤í…Œì´ì§€ ì´ë¯¸ì§€';
      } else {
        var n2 = parseInt(stage, 10) || 0;
        imgEl.alt = (n2 === 0 ? 'ì‹œì‘ ìŠ¤í…Œì´ì§€ ì´ë¯¸ì§€' : ('ìŠ¤í…Œì´ì§€ ' + n2 + ' ì´ë¯¸ì§€'));
      }
    }

    // --- External HTML loader for stage fragments ---
    function loadStageFragment(targetSelector, url) {
      var el = document.querySelector(targetSelector);
      if (!el) return;
      // file:// í™˜ê²½ì—ì„œëŠ” fetchê°€ ì°¨ë‹¨ë˜ë¯€ë¡œ iframeìœ¼ë¡œ ë¡œë“œ
      if (location.protocol === 'file:') {
        el.innerHTML = '<iframe class="stage-iframe" id="stage-iframe" loading="lazy" title="ìŠ¤í…Œì´ì§€ ì½˜í…ì¸ " src="' + url + '"></iframe>';
        // Parent-side: listen once for size messages
        if (!window.__stageIframeResizeHandler) {
          window.__stageIframeResizeHandler = function(e){
            var d = e && e.data;
            if (!d || d.type !== 'stage-iframe-size' || typeof d.height !== 'number') return;
            var iframe = document.getElementById('stage-iframe') || document.querySelector('#stageContent iframe.stage-iframe');
            if (!iframe) return;
            var newH = Math.max(50, Math.min(100000, Math.floor(d.height)));
            iframe.style.height = newH + 'px';
          };
          window.addEventListener('message', window.__stageIframeResizeHandler);
        }
        // After iframe loads, ping child to send its size
        var ifr = el.querySelector('iframe');
        if (ifr) {
          ifr.addEventListener('load', function(){
            try { ifr.contentWindow && ifr.contentWindow.postMessage({ type: 'stage-iframe-ping' }, '*'); } catch (_) { /* ignore */ }
          });
        }
        return;
      }
      try {
        fetch(url, { cache: 'no-store' })
          .then(function(resp){ if (!resp.ok) throw new Error('HTTP ' + resp.status); return resp.text(); })
          .then(function(html){ el.innerHTML = html; })
          .catch(function(){
            el.innerHTML = '<div class="hint">ì™¸ë¶€ íŒŒì¼(' + url + ')ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. íŒŒì¼ì´ ê°™ì€ í´ë”ì— ìˆëŠ”ì§€ í™•ì¸í•˜ê±°ë‚˜, ë¡œì»¬ ì„œë²„ë¡œ ì—´ì–´ì£¼ì„¸ìš”.</div>';
          });
      } catch (e) {
        el.innerHTML = '<div class="hint">ë¸Œë¼ìš°ì € ë³´ì•ˆ ì •ì±…ìœ¼ë¡œ ë¡œì»¬ íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ' + url + 'ì„(ë¥¼) ì„œë²„ì—ì„œ ì œê³µí•˜ê±°ë‚˜ ìˆ˜ë™ìœ¼ë¡œ ë¶™ì—¬ë„£ì–´ ì£¼ì„¸ìš”.</div>';
      }
    }

    // Per-callsign stage helpers
  var SESSION = { callsign: null };
  // localStorage helpers (fallback when cookies are blocked)
  function lsGet(key) { try { return window.localStorage.getItem(key); } catch (e) { return null; } }
  function lsSet(key, val) { try { window.localStorage.setItem(key, val); } catch (e) { /* ignore */ } }
  function lsRemove(key) { try { window.localStorage.removeItem(key); } catch (e) { /* ignore */ } }
    function stageCookieKey(callsign) {
      if (!callsign) return null;
      return 'stage_' + encodeURIComponent(String(callsign).toLowerCase());
    }
    function getCurrentCallsign() {
      return SESSION.callsign || getCookie('current_callsign') || lsGet('current_callsign') || getCookie('callsign') || lsGet('callsign');
    }
    function getStageForCallsign(callsign) {
      var key = stageCookieKey(callsign);
      if (!key) return null;
      var val = getCookie(key);
      if (val == null) {
        val = lsGet(key);
      }
      var stage = safeStageValue(val);
      if (stage) return stage;
      // Legacy migration: old cookie keys 'callsign' and 'stage'
      var legacyCall = getCookie('callsign') || lsGet('callsign');
      var legacyStage = safeStageValue(getCookie('stage') || lsGet('stage'));
      if (legacyCall && legacyStage && String(legacyCall).toLowerCase() === String(callsign).toLowerCase()) {
        // migrate
        setStageForCallsign(callsign, legacyStage);
        return legacyStage;
      }
      return null;
    }
    function setStageForCallsign(callsign, stage) {
      var key = stageCookieKey(callsign);
      if (!key) return;
      setCookie(key, String(stage), 30);
      lsSet(key, String(stage));
    }
    function eraseAllProgress() {
      var parts = document.cookie.split(';');
      for (var i = 0; i < parts.length; i++) {
        var kv = parts[i].trim();
        var eq = kv.indexOf('=');
        var name = eq >= 0 ? kv.substring(0, eq) : kv;
        if (name === 'current_callsign' || name.indexOf('stage_') === 0 || name === 'callsign' || name === 'stage') {
          eraseCookie(name);
        }
      }
      try {
        for (var i2 = window.localStorage.length - 1; i2 >= 0; i2--) {
          var k = window.localStorage.key(i2);
          if (!k) continue;
          if (k === 'current_callsign' || k === 'callsign' || k === 'stage' || k.indexOf('stage_') === 0) {
            window.localStorage.removeItem(k);
          }
        }
      } catch (e) { /* ignore */ }
    }

    function safeStageValue(val) {
      if (val === "complete") return "complete";
      var n = parseInt(val, 10);
      if (!isNaN(n) && n >= 1 && n <= 7) return n;
      return null;
    }

    function goStage(stage) {
      if (stage === "complete") return showComplete();
      if (stage >= 1 && stage <= 7) return showStage(stage);
      return showStage0(); // fallback
    }

    // --- Views ---
    function showStage0() {
      // Always start here; user provides callsign to resolve stage
  var savedCall = getCurrentCallsign() || "";

  // Update header image for Stage0
  updateStageHero(0);

      var $view = $('<div/>');
      $view.append('<h1>âš”ï¸ ë˜ì „ì•¤ì½”íŒŒì¼ëŸ¿4ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤.</h1>');
      $view.append('<p>ì´ í”„ë¡œê·¸ë¨ì€ Microsoft Korea ì„ì§ì›ì„ ìœ„í•œ ì½”íŒŒì¼ëŸ¿ ê²Œì„ìœ¼ë¡œ, ì½”íŒŒì¼ëŸ¿ì˜ ê¸°ëŠ¥ê³¼ ì ì¬ë ¥ì„ ì¬ë¯¸ìˆê³  ìœ ì¾Œí•œ ë°©ì‹ìœ¼ë¡œ ì²´í—˜í•˜ë„ë¡ ê³ ì•ˆë˜ì—ˆìŠµë‹ˆë‹¤.</p>');
      $view.append('<p>ì§€ê¸ˆë¶€í„° ì•½ ì„¸ ì‹œê°„ ë™ì•ˆ GPT-5ë¡œ ë”ìš± ë§‰ê°•í•´ì§„ ì½”íŒŒì¼ëŸ¿ì„ ì´ìš©í•´ ë‹¤ì–‘í•œ ë¯¸ì…˜ì„ ìˆ˜í–‰í•˜ì…”ì•¼ í•©ë‹ˆë‹¤. ë³¸ ê²Œì„ì€ ê°œì¸ í”Œë ˆì´ê²Œì„ì´ì§€ë§Œ ì£¼ë³€ë™ë£Œì™€ ë‹¤ì–‘í•œ ê²½í—˜ê³¼ ì˜ê²¬ì„ ë‚˜ëˆ„ë©° ì¦ê²ê²Œ í”Œë ˆì´ í•´ì£¼ì„¸ìš”.</p>');
      $view.append('<hr />');
      $view.append('<h2>ğŸ•¹ï¸ ê²Œì„ì˜ ê¸°ë³¸ ê·œì¹™ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:</h2>');
      $view.append('<ul><li>ê° ë‹¨ê³„ë§ˆë‹¤ ì£¼ì–´ì§„ ë¯¸ì…˜ì„ í•´ê²°í•˜ê¸° ìœ„í•œ ì•”í˜¸ê°€ ìˆìŠµë‹ˆë‹¤. ì˜¬ë°”ë¥¸ ì•”í˜¸ë¥¼ ì…ë ¥í•´ì•¼ ë‹¤ìŒ ë‹¨ê³„ë¡œ ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li><li>ì•”í˜¸ëŠ” ë˜ì „ê´€ë¦¬ìê°€ ì •í•´ì§„ ì‹œê°ë§ˆë‹¤ ê³µì§€í•´ ë“œë¦½ë‹ˆë‹¤.</li><li>ì½œì‚¬ì¸(ë³„ëª…)ì„ ì…ë ¥í•˜ì—¬ ê²Œì„ì„ ì‹œì‘í•©ë‹ˆë‹¤. ì½œì‚¬ì¸ì€ ë³¸ì¸ì„ ì‹ë³„í•  ìˆ˜ ìˆëŠ” ë³„ëª…ì´ë©´ ë¬´ì—‡ì´ë“  ì¢‹ìŠµë‹ˆë‹¤.</li><li>ê²Œì„ ì§„í–‰ ìƒí™©ì€ ì½œì‚¬ì¸ë³„ë¡œ ì €ì¥ë˜ë¯€ë¡œ, ì–¸ì œë“ ì§€ ì¤‘ë‹¨í–ˆë‹¤ê°€ ë‹¤ì‹œ ì‹œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li></ul>');
      $view.append('<hr />');
      $view.append('<h2>ğŸ  ì˜¤ëŠ˜ì˜ ë˜ì „ì€ 7ê°œì˜ ìŠ¤í…Œì´ì§€ë¡œ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</h2>');
      $view.append('<table border="1"><tr><th width=100>ìŠ¤í…Œì´ì§€</th><th width=400>ë¯¸ì…˜</th><th width=150>ì˜ˆìƒ ì†Œìš” ì‹œê°„</th></tr><tr><td>Stage 1</td><td>ì»¬ëŸ¬ë§ë¶ ë§Œë“¤ê¸°(ê¸°ë¶€í™œë™)</td><td>20ë¶„</td></tr><tr><td>Stage 2</td><td>GPT-5ë¡œ ë”ìš± ê°•ë ¥í•´ì§„ ì½”íŒŒì¼ëŸ¿ [Work]</td><td>20ë¶„</td></tr><tr><td>Stage 3</td><td>ì›Œë“œ ì½”íŒŒì¼ëŸ¿ ì œëŒ€ë¡œ í™œìš©í•˜ê¸°</td><td>15ë¶„</td></tr><tr><td>Stage 4</td><td>ì˜¤í”¼ìŠ¤ì™€ ì½”íŒŒì¼ëŸ¿ì˜ í™˜ìƒì ì¸ ì½œë¼ë³´ë ˆì´ì…˜</td><td>40ë¶„</td></tr><tr><td>Stage 5</td><td>ë¦¬ì„œì¹˜ ë„êµ¬ ì—ì´ì „íŠ¸ í™œìš©í•´ ë³´ê¸°</td><td>30ë¶„</td></tr><tr><td>Stage 6</td><td>Employee Self Service ì—ì´ì „íŠ¸ í™œìš©í•´ë³´ê¸°</td><td>20ë¶„</td></tr><tr><td>Stage 7</td><td>ìŠˆí¼ ê°„ë‹¨ ì—ì´ì „íŠ¸ ë§Œë“¤ì–´ë³´ê¸°</td><td>20ë¶„</td></tr></table>');
      $view.append('<p><b>ì!! ì¤€ë¹„ë˜ì…¨ë‚˜ìš”? ì¶œë°œ~~! </b></p>');
      $view.append('<hr />');
      $view.append('<div class="status">ğŸŸï¸ Stage0 â€¢ ì½œì‚¬ì¸(ë³„ëª…)ì„ ì…ë ¥í•´ ì‹œì‘í•˜ì„¸ìš”.</div>');
      $view.append('<label for="callsign">ì½œì‚¬ì¸</label>');
      var $input = $('<input type="text" id="callsign" placeholder="ë³¸ì¸ì„ ì‹ë³„í•  ìˆ˜ ìˆëŠ” ë³„ëª…ì´ë©´ ë¬´ì—‡ì´ë“  ì¢‹ìŠµë‹ˆë‹¤." />').val(savedCall);
      $view.append($input);
      $view.append('<div class="hint">ì…ë ¥ í›„ ì‹œì‘ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì§„í–‰ë©ë‹ˆë‹¤.</div>');

      var $row = $('<div class="row"></div>');
      var $btn = $('<button>ì‹œì‘</button>');
      $row.append($btn);

      var $reset = $('<button class="secondary" type="button">ì „ì²´ ì´ˆê¸°í™”</button>').on('click', function() {
        eraseAllProgress();
        $('#app').empty(); showStage0();
      });
      $row.append($reset);

      $view.append($row);
      $view.append('<div class="error" id="err"></div>');
      $('#app').html($view);

      function start() {
        var cs = $input.val().trim();
        if (!cs) { $('#err').text('ì½œì‚¬ì¸ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.'); $input.focus(); return; }
        SESSION.callsign = cs; // keep in-memory for file:// where cookies may be blocked
        setCookie('current_callsign', cs, 30);
        lsSet('current_callsign', cs);
        var s = getStageForCallsign(cs);
        if (s) { goStage(s); return; }
        setStageForCallsign(cs, 1);
        showStage(1, cs);
      }
      $btn.on('click', start);
      $input.on('keydown', function(e) { if (e.key === 'Enter') start(); });
      $input.trigger('focus');
    }

    function showStage(n, callsign) {
      callsign = callsign || getCurrentCallsign();
      if (!callsign) { showStage0(); return; }
      setStageForCallsign(callsign, n); // ensure cookie reflects current stage for this callsign

  // Update header image for current stage
  updateStageHero(n);

      var $view = $('<div/>');
      $view.append(
        $('<div class="status"></div>').html(
          'í˜„ì¬ ë‹¨ê³„: <strong>Stage' + n + '</strong> Â· ì½œì‚¬ì¸: <span class="badge">' + $('<div>').text(callsign).html() + '</span>'
        )
      );
      $view.append('<hr/>');
      if (n !== 0) {
        // Placeholder for external content of this stage
        $view.append('<div id="stageContent" class="panel"></div>');
      }
      $view.append('<hr/>');
      $view.append('<div class="spacer"></div>');
      $view.append('<div>ğŸš© ì•„ë˜ì— ì´ ë‹¨ê³„ì˜ ì•”í˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”. ì •ë‹µì´ë©´ ë‹¤ìŒ ë‹¨ê³„ë¡œ ì´ë™í•©ë‹ˆë‹¤.</div>');
      $view.append('<div class="spacer"></div>');
      $view.append('<label for="keycode">ì•”í˜¸</label>');
      var $input = $('<input type="text" id="keycode" inputmode="numeric" autocomplete="off" placeholder="" />');
      $view.append($input);

      var $row = $('<div class="row"></div>');
      var $submit = $('<button>í™•ì¸</button>');
      var $reset = $('<button class="secondary" type="button">ì½œì‚¬ì¸ ë³€ê²½</button>').on('click', function() {
        // Just forget current_callsign; keep stored per-callsign progress
        SESSION.callsign = null;
        eraseCookie('current_callsign');
        lsRemove('current_callsign');
        $('#app').empty(); showStage0();
      });
      $row.append($submit).append($reset);
      $view.append($row);

      $view.append('<div class="error" id="err"></div>');
      $('#app').html($view);

      // After mounting, load external HTML for current stage
      if (n !== 0) {
        loadStageFragment('#stageContent', 'stage' + n + '.html');
      }

      function verify() {
        var v = ($input.val() || '').trim();
        if (!v) { $('#err').text('ë‹¤ìŒ ë‹¨ê³„ë¡œ ë„˜ì–´ê°€ë ¤ë©´ ì•”í˜¸ ì…ë ¥'); $input.focus(); return; }
        
        // ì‹¤ì‹œê°„ìœ¼ë¡œ key.htmlì—ì„œ í‚¤ì½”ë“œ ê°€ì ¸ì˜¤ê¸°
        loadKeyCodes(function(error, keycodes) {
          if (error) {
            $('#err').text('í‚¤ì½”ë“œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error);
            return;
          }
          
          if (v === keycodes[n]) {
            if (n < 7) {
              var next = n + 1;
              setStageForCallsign(callsign, next);
              showStage(next, callsign);
            } else {
              setStageForCallsign(callsign, 'complete');
              showComplete(callsign);
            }
          } else {
            $('#err').text('ì•”í˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
            $input.select().focus();
          }
        });
      }
      $submit.on('click', verify);
      $input.on('keydown', function(e) { if (e.key === 'Enter') verify(); });
      $input.trigger('focus');
    }

    function showComplete(callsign) {
      callsign = callsign || getCurrentCallsign() || '(ë¯¸ì§€ì •)';
      // Update header image for completion
      updateStageHero('complete');
      var $view = $('<div/>');
      $view.append('<div class="status">ì™„ê²°ë˜ì—ˆìŠµë‹ˆë‹¤.</div>');
      $view.append('<hr />');
      $view.append(
        $('<div></div>').html(
          '<h2>ì¶•í•˜í•©ë‹ˆë‹¤, ' + $('<div>').text(callsign).html() + ' ë‹˜! ëª¨ë“  ë‹¨ê³„ë¥¼ ë§ˆì³¤ìŠµë‹ˆë‹¤. <br /><br />ì˜¤ëŠ˜ì˜ ë˜ì „ì•¤ì½”íŒŒì¼ëŸ¿ ì²´í—˜ ì†Œê°ì„ ë¯¸íŒ… ì±—ë£¸ì— ë‚¨ê²¨ ì£¼ì„¸ìš” ~ ğŸ’–<br /><br /></h2>'
        )
      );
      $view.append('<hr />');
      var $row = $('<div class="row"></div>');
      var $restart = $('<button class="secondary" type="button">ì²˜ìŒìœ¼ë¡œ</button>').on('click', function() {
        if (callsign && callsign !== '(ë¯¸ì§€ì •)') {
          setStageForCallsign(callsign, 1);
        }
        SESSION.callsign = null;
        eraseCookie('current_callsign');
        lsRemove('current_callsign');
        showStage0();
      });
      var $reset = $('<button type="button">ì™„ì „ ì´ˆê¸°í™”</button>').on('click', function() {
        eraseAllProgress();
        showStage0();
      });
      $row.append($restart).append($reset);
      $view.append($row);
      $('#app').html($view);
    }

    // --- Bootstrap (no $ dependency until ensured) ---
    document.addEventListener('DOMContentLoaded', function(){
      ensureJQuery(function(){
        // ì„±ê³µì ìœ¼ë¡œ jQueryê°€ ì¤€ë¹„ë¨
        showStage0();
      }, function(){
        var el = document.getElementById('app');
        if (el) {
          el.innerHTML = '<div class="error">jQueryë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•˜ê±°ë‚˜ ì¸í„°ë„·ì´ ê°€ëŠ¥í•œ í™˜ê²½ì—ì„œ ë‹¤ì‹œ ì—´ì–´ì£¼ì„¸ìš”.</div>';
        }
      });
    });
  </script>
  <div class="vibe">
  	<details class="fold">
			<summary> ì´ ì•±ì€ ê¹ƒí—™ì½”íŒŒì¼ëŸ¿ì„ ì´ìš©í•´ ë°”ì´ë¸Œì½”ë”©ìœ¼ë¡œ ë§Œë“¤ì–´ì¡ŒìŠµë‹ˆë‹¤.</summary>
			<div class="fold-body">
				<img src="img/image copy 7.png" alt="" style="max-width:100%; height:auto; border:1px solid #e5e7eb; border-radius:8px;" />
			</div>
		</details>
  </div>
</body>
</html>
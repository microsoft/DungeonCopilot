<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë˜ì „ì•¤ì½”íŒŒì¼ëŸ¿6</title>
    <link rel="stylesheet" href="common.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body class="root">
    <div class="container">
        <div class="logo">
            <img src="img/titlelogo.png" alt="ë˜ì „ì•¤ì½”íŒŒì¼ëŸ¿5">
        </div>
        
        <div class="tabs">
            <button class="tab" data-stage="0">Stage 0</button>
            <button class="tab locked" data-stage="1">Stage 1 ğŸ”’</button>
            <button class="tab locked" data-stage="2">Stage 2 ğŸ”’</button>
            <button class="tab locked" data-stage="3">Stage 3 ğŸ”’</button>
            <button class="tab locked" data-stage="4">Stage 4 ğŸ”’</button>
            <button class="tab locked" data-stage="5">Stage 5 ğŸ”’</button>
            <button class="tab locked" data-stage="6">Stage 6 ğŸ”’</button>
            <button class="tab locked" data-stage="7">Stage 7 ğŸ”’</button>
        </div>
        
        <div class="content">
            <div id="messageArea"></div>
            <iframe id="stageContent" src="" onload="resizeIframe(this)"></iframe>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜ startDate ì„ ì–¸
        var startDate = '20251005';

        // iframe ë†’ì´ ìë™ ì¡°ì • í•¨ìˆ˜ (ì „ì—­ í•¨ìˆ˜ë¡œ ì„ ì–¸)
        function resizeIframe(iframe) {
            try {
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                if (iframeDoc && iframeDoc.body) {
                    const height = iframeDoc.body.scrollHeight;
                    iframe.style.height = (height + 30) + 'px';
                }
            } catch(e) {
                // ë¡œì»¬ íŒŒì¼ì€ ë¬¸ì œì—†ì§€ë§Œ í˜¹ì‹œ ëª¨ë¥¼ ì—ëŸ¬ ì²˜ë¦¬
                iframe.style.height = '500px';
            }
        }

        // postMessageë¥¼ í†µí•œ iframe ë†’ì´ ì¡°ì •
        window.addEventListener('message', function(e) {
            if (e.data.type === 'resize') {
                const iframe = document.getElementById('stageContent');
                iframe.style.height = (e.data.height + 40) + 'px';
            }
        });

        $(document).ready(function() {
            // URL ë§¤ê°œë³€ìˆ˜ì—ì„œ startDate ê°€ì ¸ì˜¤ê¸°
            const urlParams = new URLSearchParams(window.location.search);
            const urlStartDate = urlParams.get('startDate');
            
            if (urlStartDate) {
                startDate = urlStartDate;
            }

            // ë‚ ì§œ ì°¨ì´ ê³„ì‚° í•¨ìˆ˜
            function getDaysDifference(startDateStr) {
                const year = parseInt(startDateStr.substring(0, 4));
                const month = parseInt(startDateStr.substring(4, 6)) - 1;
                const day = parseInt(startDateStr.substring(6, 8));
                
                const start = new Date(year, month, day);
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                const diffTime = today - start;
                const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
                
                return diffDays;
            }

            // ë‚ ì§œ í¬ë§· í•¨ìˆ˜ (YYYYmmDD -> YYYYë…„ Mì›” Dì¼)
            function formatDate(dateStr) {
                const year = parseInt(dateStr.substring(0, 4));
                const month = parseInt(dateStr.substring(4, 6));
                const day = parseInt(dateStr.substring(6, 8));
                return year + 'ë…„ ' + month + 'ì›” ' + day + 'ì¼';
            }

            // ë‚ ì§œ ê³„ì‚° í•¨ìˆ˜ (startDate + days)
            function addDays(startDateStr, days) {
                const year = parseInt(startDateStr.substring(0, 4));
                const month = parseInt(startDateStr.substring(4, 6)) - 1;
                const day = parseInt(startDateStr.substring(6, 8));
                
                const date = new Date(year, month, day);
                date.setDate(date.getDate() + days);
                
                const resultYear = date.getFullYear();
                const resultMonth = String(date.getMonth() + 1).padStart(2, '0');
                const resultDay = String(date.getDate()).padStart(2, '0');
                
                return resultYear + resultMonth + resultDay;
            }

            // í´ë¦­ ê°€ëŠ¥í•œ íƒ­ ìˆ˜ ê³„ì‚°
            const daysPassed = getDaysDifference(startDate);
            const unlockableTabs = Math.min(Math.max(1, daysPassed + 1), 8); // ìµœì†Œ 1ê°œ(Stage 0), ìµœëŒ€ 8ê°œ

            // íƒ­ ìƒíƒœ ì—…ë°ì´íŠ¸
            $('.tab').each(function(index) {
                const stage = $(this).data('stage');
                if (stage < unlockableTabs) {
                    $(this).removeClass('locked');
                    $(this).text('Stage ' + stage);
                }
            });

            // íƒ­ í´ë¦­ ì´ë²¤íŠ¸
            $('.tab').on('click', function() {
                const stage = $(this).data('stage');
                
                if ($(this).hasClass('locked')) {
                    // ì ê¸´ íƒ­ í´ë¦­ ì‹œ
                    const unlockDate = addDays(startDate, stage);
                    const unlockDateFormatted = formatDate(unlockDate);
                    showMessage('ğŸ”’ Stage ' + stage + 'ì€(ëŠ”) ' + unlockDateFormatted + 'ì— ê°œë°©ë©ë‹ˆë‹¤.');
                    return;
                }
                
                $('.tab').removeClass('active');
                $(this).addClass('active');
                
                loadStageContent(stage);
            });

            // ìŠ¤í…Œì´ì§€ ì»¨í…ì¸  ë¡œë“œ í•¨ìˆ˜
            function loadStageContent(stage) {
                $('#messageArea').hide();
                $('#stageContent').show();
                const stageFile = 'stage' + stage + '.html';
                $('#stageContent').attr('src', stageFile);
            }

            // ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜
            function showMessage(message) {
                $('#stageContent').hide();
                $('#messageArea').html('<div class="message">' + message + '</div>');
                $('#messageArea').show();
            }

            // ì´ˆê¸° Stage 0 ë¡œë“œ
            $('.tab[data-stage="0"]').addClass('active');
            loadStageContent(0);
        });
    </script>
</body>
</html>
